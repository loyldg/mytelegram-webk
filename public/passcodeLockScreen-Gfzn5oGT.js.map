{"version":3,"file":"passcodeLockScreen-Gfzn5oGT.js","sources":["../src/components/passcodeLock/passwordMonkeyTsx.tsx","../src/components/passcodeLock/simplePopup.tsx","../src/components/passcodeLock/background.tsx","../src/components/passcodeLock/passcodeLockScreen.tsx"],"sourcesContent":["import {Component, createRenderEffect, createSignal, mergeProps, onCleanup, Ref, Show} from 'solid-js';\n\nimport {useLockScreenHotReloadGuard} from '../../lib/solidjs/hotReloadGuard';\n\nimport type PasswordInputField from '../passwordInputField';\nimport type PasswordMonkey from '../monkeys/password';\n\nimport styles from './passwordMonkeyTsx.module.scss';\n\n\nconst PasswordMonkeyTsx: Component<{\n  ref?: Ref<HTMLDivElement>;\n  passwordInputField: PasswordInputField;\n  hidden?: boolean;\n  size?: number;\n}> = (inProps) => {\n  const props = mergeProps({size: 100}, inProps);\n\n  const {PasswordMonkey} = useLockScreenHotReloadGuard();\n\n  const [monkey, setMonkey] = createSignal<PasswordMonkey>();\n  const [monkeyLoaded, setMonkeyLoaded] = createSignal(false);\n\n  createRenderEffect(() => {\n    const monkey = new PasswordMonkey(props.passwordInputField, props.size);\n    monkey.load().then(() => setMonkeyLoaded(true));\n    setMonkey(monkey);\n\n    onCleanup(() => {\n      monkey.remove();\n    });\n  });\n\n  return (\n    <div\n      ref={props.ref}\n      class={styles.PasswordMonkey}\n      classList={{\n        [styles.hidden]: props.hidden\n      }}\n      style={{'--size': props.size + 'px'}}\n    >\n      {monkey().container}\n\n      {/* Prevent the monkey blinking when reloading the page */}\n      <Show when={!monkeyLoaded()}>\n        <img class={styles.MonkeyImage} src=\"assets/img/password-monkey-closed.png\" />\n      </Show>\n    </div>\n  );\n};\n\nexport default PasswordMonkeyTsx;\n","import {Component, JSX, onCleanup, onMount} from 'solid-js';\nimport {Transition} from 'solid-transition-group';\nimport {Portal} from 'solid-js/web';\n\nimport pause from '../../helpers/schedulers/pause';\nimport {i18n} from '../../lib/langPack';\n\nimport ripple from '../ripple'; ripple; // keep\n\nimport styles from './simplePopup.module.scss';\n\nconst SimplePopup: Component<{\n  visible?: boolean;\n\n  title: JSX.Element;\n  description: JSX.Element;\n  confirmButtonContent: JSX.Element;\n\n  onClose?: () => void;\n  onConfirm: () => void;\n}> = (props) => {\n  onMount(() => {\n    const listener = (e: KeyboardEvent) => {\n      if(e.key === 'Escape') props.onClose?.();\n    }\n    document.addEventListener('keydown', listener);\n\n    onCleanup(() => {\n      document.removeEventListener('keydown', listener);\n    });\n  });\n\n  return (\n    <Portal>\n      <Transition\n        onEnter={async(el, done) => {\n          await pause(0);\n          el.classList.add('active');\n          await pause(0);\n          done();\n        }}\n        onExit={async(el, done) => {\n          el.classList.remove('active');\n          await pause(200);\n          done();\n        }}\n      >\n        {props.visible && <div\n          class={'popup popup-peer popup-confirmation ' + styles.Popup}\n          onClick={(e) => {\n            if(e.target === e.currentTarget) {\n              props.onClose?.();\n            }\n          }}\n        >\n          <div class='popup-container'>\n            <div class='popup-header'>\n              <div class='popup-title'>\n                {props.title}\n              </div>\n            </div>\n\n            <div class='popup-description'>\n              {props.description}\n            </div>\n\n            <div class='popup-buttons'>\n              <button class='popup-button btn danger' use:ripple onClick={props.onConfirm}>\n                {props.confirmButtonContent}\n              </button>\n              <button class='popup-button btn primary' use:ripple onClick={props.onClose} autofocus>\n                {i18n('Cancel')}\n              </button>\n            </div>\n          </div>\n        </div>}\n      </Transition>\n    </Portal>\n  );\n};\n\nexport default SimplePopup;\n","import {createEffect, createSignal, on, onCleanup, onMount, Component} from 'solid-js';\nimport {createStore, reconcile} from 'solid-js/store';\n\nimport {useLockScreenHotReloadGuard} from '../../lib/solidjs/hotReloadGuard';\nimport renderImageFromUrl from '../../helpers/dom/renderImageFromUrl';\nimport ChatBackgroundStore from '../../lib/chatBackgroundStore';\nimport mediaSizes, {ScreenSize} from '../../helpers/mediaSizes';\nimport {getColorsFromWallPaper} from '../../helpers/color';\nimport ListenerSetter from '../../helpers/listenerSetter';\nimport {DEFAULT_BACKGROUND_SLUG} from '../../config/app';\nimport {SETTINGS_INIT} from '../../config/state';\nimport {WallPaper} from '../../layer';\n\nimport ChatBackgroundGradientRenderer from '../chat/gradientRenderer';\nimport ChatBackgroundPatternRenderer from '../chat/patternRenderer';\n\nimport styles from './background.module.scss';\n\ntype StateStore = {\n  isMobile: boolean;\n  image?: HTMLImageElement;\n  patternCanvas?: HTMLCanvasElement;\n  gradientCanvas?: HTMLCanvasElement;\n};\n\n\nconst Background: Component<{\n  gradientRendererRef: (value: ChatBackgroundGradientRenderer | undefined) => void\n}> = (props) => {\n  const {themeController} = useLockScreenHotReloadGuard();\n\n  let container: HTMLDivElement;\n  const listenerSetter = new ListenerSetter();\n\n  const [store, setStore] = createStore<StateStore>({\n    isMobile: mediaSizes.activeScreen === ScreenSize.mobile\n  });\n\n  const [url, setUrl] = createSignal<string>();\n\n  async function getBackgroundURL(slug: string) {\n    if(slug === DEFAULT_BACKGROUND_SLUG) {\n      return 'assets/img/pattern.svg'\n    }\n\n    /**\n     * This delays when the background appears and makes it blink after refresh ☹️\n     */\n    // const hasInCache = await ChatBackgroundStore.hasWallPaperStorageUrl(slug);\n    // if(!hasInCache) throw new Error('No background with this slug found in cache');\n\n    return ChatBackgroundStore.getWallPaperStorageUrl(slug);\n  }\n\n  async function tryGetBackgroundURL(slug: string) {\n    try {\n      const backgroundUrl = await getBackgroundURL(slug);\n      return backgroundUrl;\n    } catch{\n      return getBackgroundURL(DEFAULT_BACKGROUND_SLUG);\n    }\n  }\n\n  async function getBackgroundParameters() {\n    try {\n      const theme = themeController.getTheme();\n      const slug = (theme.settings?.wallpaper as WallPaper.wallPaper)?.slug;\n\n      const backgroundUrl = slug ? await getBackgroundURL(slug) : undefined; // expected to throw if no cache available\n\n      const {wallpaper: wallPaper} = themeController.getThemeSettings(theme);\n      const isPattern = !!(wallPaper as WallPaper.wallPaper)?.pFlags?.pattern;\n      const intensity = wallPaper.settings?.intensity && wallPaper.settings.intensity / 100;\n      const isDarkPattern = !!intensity && intensity < 0;\n\n      return {\n        backgroundUrl,\n        isPattern,\n        isDarkPattern,\n        intensity,\n        wallPaper\n      };\n    } catch{\n      const theme = themeController.getTheme();\n      const defaultTheme = SETTINGS_INIT.themes.find((t) => t.name === theme.name);\n      const slug = (defaultTheme.settings?.wallpaper as WallPaper.wallPaper)?.slug || DEFAULT_BACKGROUND_SLUG;\n\n      const backgroundUrl = await tryGetBackgroundURL(slug) ;\n\n      const {wallpaper: wallPaper} = themeController.getThemeSettings(defaultTheme);\n      const isPattern = !!(wallPaper as WallPaper.wallPaper)?.pFlags?.pattern;\n      const intensity = wallPaper.settings?.intensity && wallPaper.settings.intensity / 100;\n      const isDarkPattern = !!intensity && intensity < 0;\n\n      return {\n        backgroundUrl,\n        isPattern,\n        isDarkPattern,\n        intensity,\n        wallPaper\n      };\n    }\n  }\n\n  async function createBackground() {\n    const {\n      backgroundUrl,\n      isPattern,\n      isDarkPattern,\n      intensity,\n      wallPaper\n    } = await getBackgroundParameters();\n\n    setUrl(backgroundUrl);\n\n    let\n      image: HTMLImageElement,\n      patternCanvas: HTMLCanvasElement,\n      gradientCanvas: HTMLCanvasElement,\n      patternRenderer: ChatBackgroundPatternRenderer\n    ;\n\n    if(backgroundUrl) {\n      if(isPattern) {\n        const rect = container.getBoundingClientRect();\n        const patternRenderer = ChatBackgroundPatternRenderer.getInstance({\n          element: container,\n          url: backgroundUrl,\n          width: rect.width,\n          height: rect.height,\n          mask: isDarkPattern\n        });\n\n        patternCanvas = patternRenderer.createCanvas();\n        patternCanvas.classList.add(styles.CanvasCommon)\n        if(!isDarkPattern) patternCanvas.classList.add(styles.blend);\n\n        patternRenderer.renderToCanvas(patternCanvas);\n      } else {\n        image = document.createElement('img');\n        image.classList.add(styles.CanvasCommon);\n        renderImageFromUrl(image, backgroundUrl);\n      }\n    }\n\n    const colors = getColorsFromWallPaper(wallPaper);\n    if(colors) {\n      const {canvas, gradientRenderer} = ChatBackgroundGradientRenderer.create(colors);\n      gradientCanvas = canvas;\n      props.gradientRendererRef(gradientRenderer);\n      gradientCanvas.classList.add(styles.CanvasCommon);\n    }\n\n    if(intensity) {\n      let setOpacityTo: HTMLElement;\n      if(image) {\n        setOpacityTo = image;\n      } else {\n        setOpacityTo = isDarkPattern ? gradientCanvas : patternCanvas;\n      }\n\n      let opacityMax = Math.abs(intensity) * (isDarkPattern ? .5 : 1);\n      if(image) {\n        opacityMax = Math.max(0.3, 1 - intensity);\n      } else if(isDarkPattern) {\n        opacityMax = Math.max(0.3, opacityMax);\n      }\n\n      setOpacityTo?.style.setProperty('--opacity-max', '' + opacityMax);\n    }\n\n    setStore({\n      gradientCanvas,\n      patternCanvas,\n      image\n    });\n\n    return {patternRenderer};\n  }\n\n  onMount(() => {\n    listenerSetter.add(window)('resize', () => {\n      ChatBackgroundPatternRenderer.resizeInstancesOf(container);\n    });\n    listenerSetter.add(mediaSizes)('changeScreen', (_, to) => {\n      setStore({\n        isMobile: to === ScreenSize.mobile\n      });\n    });\n  });\n\n  createEffect(on(() => store.isMobile, () => {\n    if(store.isMobile) return;\n\n    const promise = createBackground();\n\n    onCleanup(() => {\n      const patternCanvas = store.patternCanvas;\n      promise.then(({patternRenderer}) => {\n        patternRenderer?.cleanup(patternCanvas);\n      });\n\n      props.gradientRendererRef(undefined);\n\n      setStore(reconcile({\n        isMobile: store.isMobile\n      }));\n    });\n  }));\n\n  onCleanup(() => {\n    listenerSetter.removeAll();\n  });\n\n  return (\n    <div ref={container} class={styles.Container}>\n      {store.gradientCanvas}\n      {store.patternCanvas}\n      {store.image}\n      {url() && <img class={styles.CanvasCommon} style={{visibility: 'hidden'}} src={url()} />}\n    </div>\n  );\n};\n\nexport default Background;\n","import {Component, createEffect, createResource, on, onCleanup, onMount, Show} from 'solid-js';\nimport {createMutable} from 'solid-js/store';\n\nimport {useLockScreenHotReloadGuard} from '../../lib/solidjs/hotReloadGuard';\nimport AccountController from '../../lib/accounts/accountController';\nimport {MAX_PASSCODE_LENGTH} from '../../lib/passcode/constants';\nimport {usePasscodeActions} from '../../lib/passcode/actions';\nimport commonStateStorage from '../../lib/commonStateStorage';\nimport pause from '../../helpers/schedulers/pause';\nimport {i18n} from '../../lib/langPack';\n\nimport ChatBackgroundGradientRenderer from '../chat/gradientRenderer';\nimport type PasswordInputField from '../passwordInputField';\nimport {animateValue} from '../mediaEditor/utils';\nimport ripple from '../ripple'; ripple; // keep\nimport Space from '../space';\n\nimport PasswordMonkeyTsx from './passwordMonkeyTsx';\nimport SimplePopup from './simplePopup';\nimport Background from './background';\n\nimport styles from './passcodeLockScreen.module.scss';\nimport focusInput from '../../helpers/dom/focusInput';\nimport throttle from '../../helpers/schedulers/throttle';\n\n\ntype StateStore = {\n  isMonkeyHidden: boolean;\n  isError: boolean;\n  tooManyAttempts: boolean;\n  passcode: string;\n  isLogoutPopupOpen: boolean;\n  gradientRenderer?: ChatBackgroundGradientRenderer;\n};\n\n\nconst MAX_ATTEMPTS = 5;\nconst MAX_ATTEMPTS_TIMEOUT_SEC = 60;\n\n\nconst PasscodeLockScreen: Component<{\n  onUnlock: () => void;\n  fromLockIcon?: HTMLElement;\n  onAnimationEnd?: () => void;\n}> = (props) => {\n  let container: HTMLDivElement;\n  let passwordInputField: PasswordInputField;\n  let passwordMonkeyContainer: HTMLDivElement;\n\n  let attempts = 0;\n\n  const {isMyPasscode, unlockWithPasscode} = usePasscodeActions();\n  const {InputFieldTsx, PasswordInputField, apiManagerProxy} = useLockScreenHotReloadGuard();\n\n  const store = createMutable<StateStore>({\n    isMonkeyHidden: !!props.fromLockIcon,\n    isError: false,\n    tooManyAttempts: false,\n    passcode: '',\n    isLogoutPopupOpen: false\n  });\n\n  const [totalAccounts] = createResource(() => AccountController.getUnencryptedTotalAccounts());\n\n  onMount(() => {\n    attempts = 0;\n\n    const lockIcon = props.fromLockIcon;\n    if(lockIcon) (async() => {\n      const lockIconRect = lockIcon.getBoundingClientRect();\n      const rect = passwordMonkeyContainer.getBoundingClientRect();\n\n      lockIcon.style.setProperty('--x', (rect.left + (rect.width / 2)) + 'px');\n      lockIcon.style.setProperty('--y', (rect.top + (rect.height / 2)) + 'px');\n      lockIcon.style.setProperty('--scale', (rect.width / lockIconRect.width) + '');\n      lockIcon.classList.add('passcode-lock-screen__animated-lock-icon--shift-body')\n\n      await pause(500);\n\n      lockIcon.classList.add('passcode-lock-screen__animated-lock-icon--disappear')\n      store.isMonkeyHidden = false;\n\n      await pause(400);\n      lockIcon.remove();\n      props.onAnimationEnd?.();\n    })();\n\n    const listener = (e: KeyboardEvent) => {\n      if(document.activeElement && document.activeElement.tagName === 'INPUT') return;\n      focusInput(passwordInputField.input, e);\n    };\n    document.addEventListener('keydown', listener);\n    onCleanup(() => {\n      document.removeEventListener('keydown', listener);\n    });\n  });\n\n  let cancelAnimation: () => void;\n\n  function rotateBackgroundGradient() {\n    cancelAnimation?.();\n\n    if(store.gradientRenderer) {\n      let progress = 0;\n      cancelAnimation = animateValue(0, 1, 200, (p) => progress = p);\n      store.gradientRenderer.toNextPosition(() => progress);\n    }\n  }\n\n  const rotateBackgroundGradientThrottled = throttle(rotateBackgroundGradient, 100, true);\n\n  createEffect(on(() => store.passcode, () => {\n    rotateBackgroundGradientThrottled();\n\n    store.isError = false;\n    store.tooManyAttempts = false;\n  }));\n\n  onCleanup(() => {\n    store.passcode = '';\n    (passwordInputField.input as HTMLInputElement).value = '';\n  });\n\n  const canSubmit = () => !!store.passcode && store.passcode.length <= MAX_PASSCODE_LENGTH;\n\n  const canAttempt = async() => {\n    const settings = structuredClone(await commonStateStorage.get('settings', false));\n    const canAttemptAgainOn = settings?.passcode?.canAttemptAgainOn;\n    if(!canAttemptAgainOn) return true;\n\n    if(canAttemptAgainOn > Date.now()) return false;\n\n    store.tooManyAttempts = false;\n    attempts = 0;\n    settings.passcode.canAttemptAgainOn = null;\n    commonStateStorage.set({settings});\n    return true;\n  };\n\n  let isSubmiting = false;\n  const onSubmit = async(e?: Event) => {\n    e?.preventDefault();\n    if(isSubmiting) return;\n\n    isSubmiting = true;\n\n    try {\n      if(!(await canAttempt())) {\n        store.tooManyAttempts = true;\n      } else if(canSubmit() && await isMyPasscode(store.passcode)) {\n        await unlockWithPasscode(store.passcode);\n        props.onUnlock();\n      } else {\n        attempts ++;\n        store.isError = true;\n        if(attempts > MAX_ATTEMPTS) {\n          store.tooManyAttempts = true;\n          const settings = structuredClone(await commonStateStorage.get('settings', false));\n          settings.passcode.canAttemptAgainOn = Date.now() + MAX_ATTEMPTS_TIMEOUT_SEC * 1000;\n          await commonStateStorage.set({settings});\n        }\n      }\n    } catch{\n      store.isError = true;\n    } finally {\n      isSubmiting = false;\n    }\n  };\n\n  const input = (\n    <InputFieldTsx\n      InputFieldClass={PasswordInputField}\n      instanceRef={(value) => void (passwordInputField = value)}\n      class={styles.Input}\n      value={store.passcode}\n      onRawInput={(value) => void (store.passcode = value)}\n      label=\"PasscodeLock.EnterYourPasscode\"\n      errorLabel={\n        store.tooManyAttempts ?\n          'PasscodeLock.TooManyAttempts' :\n          store.isError ?\n            'PasscodeLock.WrongPasscode' :\n            undefined\n      }\n      maxLength={MAX_PASSCODE_LENGTH}\n    />\n  );\n\n\n  return (\n    <div ref={container} class={styles.Container}>\n      <Background gradientRendererRef={(value) => void(store.gradientRenderer = value)} />\n      <div class={styles.Card}>\n        <PasswordMonkeyTsx\n          hidden={store.isMonkeyHidden}\n          ref={passwordMonkeyContainer}\n          passwordInputField={passwordInputField}\n        />\n        <Space amount=\"1.125rem\" />\n        <form action=\"\" onSubmit={onSubmit}>\n          {input}\n          <Space amount=\"1rem\" />\n          <button\n            type='button'\n            onMouseDown={() => {\n              onSubmit();\n            }}\n            class={`btn-primary btn-color-primary btn-large ${styles.SubmitButton}`}\n            disabled={!store.passcode}\n          >\n            {i18n('PasscodeLock.Proceed')}\n          </button>\n          <button hidden style={{visibility: 'hidden', height: '0', width: '0'}} type='submit' />\n        </form>\n        <Space amount=\"1.625rem\" />\n        <div class={styles.Description}>\n          {\n            i18n(\n              totalAccounts() > 1 ? // Gonna be `false` when undefined\n                'PasscodeLock.ForgotPasscode.MultipleAccounts' :\n                'PasscodeLock.ForgotPasscode.OneAccount',\n              [\n                <button\n                  class={styles.LogoutButton}\n                  onClick={() => {\n                    store.isLogoutPopupOpen = true;\n                  }}\n                /> as HTMLButtonElement\n              ]\n            )\n          }\n        </div>\n      </div>\n\n      <SimplePopup\n        visible={store.isLogoutPopupOpen}\n        title={i18n('LogOut')}\n        description={i18n('PasscodeLock.LogoutPopup.Description')}\n        confirmButtonContent={i18n('LogOut')}\n        onConfirm={() => {\n          apiManagerProxy.invokeVoid('forceLogout', undefined);\n          // store.isLogoutPopupOpen = false\n        }}\n        onClose={() => void(store.isLogoutPopupOpen = false)}\n      />\n    </div>\n  );\n};\n\nexport default PasscodeLockScreen;\n"],"names":["PasswordMonkeyTsx","inProps","props","mergeProps","size","PasswordMonkey","useLockScreenHotReloadGuard","monkey","setMonkey","createSignal","monkeyLoaded","setMonkeyLoaded","createRenderEffect","passwordInputField","load","then","onCleanup","remove","_el$","_tmpl$2","_ref$","ref","_$use","_$insert","container","_$createComponent","Show","when","children","_el$2","_tmpl$","_$effect","_$className","styles","MonkeyImage","_p$","_v$","_v$2","hidden","_v$3","_$classList","style","setProperty","removeProperty","undefined","SimplePopup","onMount","listener","e","key","onClose","document","addEventListener","removeEventListener","Portal","Transition","onEnter","el","done","pause","classList","add","onExit","_$memo","visible","firstChild","_el$3","_el$4","_el$5","nextSibling","_el$6","_el$7","_el$8","$$click","target","currentTarget","title","description","_$addEventListener","onConfirm","ripple","confirmButtonContent","i18n","Popup","_$delegateEvents","Background","themeController","listenerSetter","ListenerSetter","store","setStore","createStore","isMobile","mediaSizes","activeScreen","ScreenSize","mobile","url","setUrl","getBackgroundURL","slug","DEFAULT_BACKGROUND_SLUG","ChatBackgroundStore","getWallPaperStorageUrl","tryGetBackgroundURL","getBackgroundParameters","theme","getTheme","settings","wallpaper","backgroundUrl","wallPaper","getThemeSettings","isPattern","pFlags","pattern","intensity","isDarkPattern","defaultTheme","SETTINGS_INIT","themes","find","t","name","createBackground","image","patternCanvas","gradientCanvas","patternRenderer","rect","getBoundingClientRect","ChatBackgroundPatternRenderer","getInstance","element","width","height","mask","createCanvas","CanvasCommon","blend","renderToCanvas","createElement","renderImageFromUrl","colors","getColorsFromWallPaper","canvas","gradientRenderer","ChatBackgroundGradientRenderer","create","gradientRendererRef","setOpacityTo","opacityMax","Math","abs","max","window","resizeInstancesOf","_","to","createEffect","on","promise","cleanup","reconcile","removeAll","_c$","_$setAttribute","Container","MAX_ATTEMPTS","MAX_ATTEMPTS_TIMEOUT_SEC","PasscodeLockScreen","passwordMonkeyContainer","attempts","isMyPasscode","unlockWithPasscode","usePasscodeActions","InputFieldTsx","PasswordInputField","apiManagerProxy","createMutable","isMonkeyHidden","fromLockIcon","isError","tooManyAttempts","passcode","isLogoutPopupOpen","totalAccounts","createResource","AccountController","getUnencryptedTotalAccounts","lockIcon","lockIconRect","left","top","onAnimationEnd","activeElement","tagName","focusInput","input","cancelAnimation","rotateBackgroundGradient","progress","animateValue","p","toNextPosition","rotateBackgroundGradientThrottled","throttle","value","canSubmit","length","MAX_PASSCODE_LENGTH","canAttempt","structuredClone","commonStateStorage","get","canAttemptAgainOn","Date","now","set","isSubmiting","onSubmit","preventDefault","onUnlock","InputFieldClass","instanceRef","Input","onRawInput","label","errorLabel","maxLength","r$","_ref$2","Space","amount","$$mousedown","LogoutButton","invokeVoid","Card","SubmitButton","_v$4","_v$5","Description","disabled"],"mappings":"uqBAUMA,GAKAC,GAAY,CAChB,MAAMC,EAAQC,GAAW,CAACC,KAAM,GAAI,EAAEH,CAAO,EAEvC,CAACI,eAAAA,CAAe,EAAGC,EAA2B,EAE9C,CAACC,EAAQC,CAAS,EAAIC,EAAY,EAClC,CAACC,EAAcC,CAAe,EAAIF,EAAa,EAAK,EAE1DG,OAAAA,EAAmB,IAAM,CACvB,MAAML,EAAS,IAAIF,EAAeH,EAAMW,mBAAoBX,EAAME,IAAI,EACtEG,EAAOO,KAAI,EAAGC,KAAK,IAAMJ,EAAgB,EAAI,CAAC,EAC9CH,EAAUD,CAAM,EAEhBS,EAAU,IAAM,CACdT,EAAOU,OAAM,CACf,CAAC,CACH,CAAC,GAED,IAAA,CAAA,MAAAC,EAAAC,KAAAC,EAESlB,EAAMmB,IAAG,cAAAD,GAAA,WAAAE,EAAAF,EAAAF,CAAA,EAAThB,EAAMmB,IAAGH,EAAAK,EAAAL,EAAA,IAObX,EAAQ,EAACiB,UAAS,IAAA,EAAAD,EAAAL,EAAAO,EAGlBC,GAAI,CAAA,IAACC,MAAI,CAAA,MAAE,CAACjB,EAAY,CAAE,EAAA,IAAAkB,UAAA,CAAA,MAAAC,EAAAC,KAAAC,OAAAA,MAAAC,EAAAH,EACbI,EAAOC,WAAW,CAAA,EAAAL,CAAA,CAAA,CAAA,EAAA,IAAA,EAAAE,EAAAI,GAAA,CAAA,MAAAC,EAVzBH,EAAO5B,eAAcgC,EACjB,CACT,CAACJ,EAAOK,MAAM,EAAGpC,EAAMoC,MACxB,EAAAC,EACiBrC,EAAME,KAAO,KAAIgC,OAAAA,IAAAD,EAAAC,KAAAJ,EAAAd,EAAAiB,EAAAC,IAAAA,CAAA,EAAAD,EAAAE,KAAAG,GAAAtB,EAAAmB,EAAAF,EAAAE,IAAA,EAAAE,IAAAJ,EAAAI,QAAAJ,EAAAI,KAAAA,IAAA,KAAArB,EAAAuB,MAAAC,YAAAH,SAAAA,CAAA,EAAArB,EAAAuB,MAAAE,eAAA,QAAA,GAAAR,CAAA,EAAA,CAAAC,IAAAQ,OAAAP,KAAAO,OAAAL,KAAAK,MAAA,CAAA,EAAA1B,CAAA,IAUzC,uSCvCM2B,GASA3C,IACJ4C,EAAQ,IAAM,CACZ,MAAMC,EAAYC,GAAqB,CAClCA,EAAEC,MAAQ,UAAU/C,EAAMgD,UAAO,GAEtCC,SAASC,iBAAiB,UAAWL,CAAQ,EAE7C/B,EAAU,IAAM,CACdmC,SAASE,oBAAoB,UAAWN,CAAQ,CAClD,CAAC,CACH,CAAC,EAEDtB,EACG6B,GAAM,CAAA,IAAA1B,UAAA,CAAA,OAAAH,EACJ8B,GAAU,CACTC,QAAS,MAAMC,EAAIC,IAAS,CAC1B,MAAMC,EAAM,CAAC,EACbF,EAAGG,UAAUC,IAAI,QAAQ,EACzB,MAAMF,EAAM,CAAC,EACbD,GACD,EACDI,OAAQ,MAAML,EAAIC,IAAS,CACzBD,EAAGG,UAAU3C,OAAO,QAAQ,EAC5B,MAAM0C,EAAM,GAAG,EACfD,GACD,EAAA,IAAA9B,UAAA,CAAA,OAEAmC,GAAA,IAAA,CAAA,CAAA7D,EAAM8D,OAAO,EAAA,IAAA,IAAA,CAAA,MAAA9C,EAAAY,GAAA,EAAAD,EAAAX,EAAA+C,WAAAC,EAAArC,EAAAoC,WAAAE,EAAAD,EAAAD,WAAAG,EAAAF,EAAAG,YAAAC,EAAAF,EAAAC,YAAAE,EAAAD,EAAAL,WAAAO,EAAAD,EAAAF,YAAAnD,OAAAA,EAAAuD,QAEFzB,GAAM,CACXA,EAAE0B,SAAW1B,EAAE2B,eAChBzE,EAAMgD,UAAO,GAEhB3B,EAAA4C,EAKMjE,IAAAA,EAAM0E,KAAK,EAAArD,EAAA6C,EAKblE,IAAAA,EAAM2E,WAAW,EAAAC,EAAAP,EAI0CrE,QAAAA,EAAM6E,UAAS,EAAA,EAAAzD,EAA/B0D,EAAMT,EAAA,IAAA,EAAA,EAAAhD,EAAAgD,EAC/CrE,IAAAA,EAAM+E,oBAAoB,EAAAH,EAAAN,EAEgCtE,QAAAA,EAAMgD,QAAO,EAAA,EAAA5B,EAA7B0D,EAAMR,EAAA,IAAA,EAAA,EAAAjD,EAAAiD,EAAA,IAChDU,EAAK,QAAQ,CAAC,EAAAnD,EAAA,IAAAC,EAAAd,EAvBd,uCAAyCe,GAAOkD,KAAK,CAAA,EAAAjE,KA2BxD,CAAA,CAAA,CAAA,CAAA,CAAA,GAMakE,GAAA,CAAA,OAAA,CAAA,uJCvDrBC,GAEAnF,GAAU,CACd,KAAM,CAACoF,gBAAAA,CAAgB,EAAGhF,EAA2B,EAErD,IAAIkB,EACJ,MAAM+D,EAAiB,IAAIC,GAErB,CAACC,EAAOC,CAAQ,EAAIC,GAAwB,CAChDC,SAAUC,EAAWC,eAAiBC,GAAWC,MACnD,CAAC,EAEK,CAACC,EAAKC,CAAM,EAAIzF,EAAY,EAElC,eAAe0F,EAAiBC,EAAc,CAC5C,OAAGA,IAASC,EACH,yBASFC,GAAoBC,uBAAuBH,CAAI,CACxD,CAEA,eAAeI,EAAoBJ,EAAc,CAC/C,GAAI,CAEF,OADsB,MAAMD,EAAiBC,CAAI,CAEnD,MAAO,CACL,OAAOD,EAAiBE,CAAuB,CACjD,CACF,CAEA,eAAeI,GAA0B,CACvC,GAAI,CACF,MAAMC,EAAQpB,EAAgBqB,WACxBP,EAAQM,EAAME,UAAUC,WAAmCT,KAE3DU,EAAgBV,EAAO,MAAMD,EAAiBC,CAAI,EAAIxD,OAEtD,CAACiE,UAAWE,CAAS,EAAIzB,EAAgB0B,iBAAiBN,CAAK,EAC/DO,EAAY,CAAC,CAAEF,GAAmCG,QAAQC,QAC1DC,EAAYL,EAAUH,UAAUQ,WAAaL,EAAUH,SAASQ,UAAY,IAC5EC,EAAgB,CAAC,CAACD,GAAaA,EAAY,EAEjD,MAAO,CACLN,cAAAA,EACAG,UAAAA,EACAI,cAAAA,EACAD,UAAAA,EACAL,UAAAA,EAEJ,MAAO,CACL,MAAML,EAAQpB,EAAgBqB,WACxBW,EAAeC,GAAcC,OAAOC,KAAMC,GAAMA,EAAEC,OAASjB,EAAMiB,IAAI,EACrEvB,EAAQkB,EAAaV,UAAUC,WAAmCT,MAAQC,EAE1ES,EAAgB,MAAMN,EAAoBJ,CAAI,EAE9C,CAACS,UAAWE,CAAS,EAAIzB,EAAgB0B,iBAAiBM,CAAY,EACtEL,EAAY,CAAC,CAAEF,GAAmCG,QAAQC,QAC1DC,EAAYL,EAAUH,UAAUQ,WAAaL,EAAUH,SAASQ,UAAY,IAC5EC,EAAgB,CAAC,CAACD,GAAaA,EAAY,EAEjD,MAAO,CACLN,cAAAA,EACAG,UAAAA,EACAI,cAAAA,EACAD,UAAAA,EACAL,UAAAA,EAEJ,CACF,CAEA,eAAea,GAAmB,CAChC,KAAM,CACJd,cAAAA,EACAG,UAAAA,EACAI,cAAAA,EACAD,UAAAA,EACAL,UAAAA,CACF,EAAI,MAAMN,EAAuB,EAEjCP,EAAOY,CAAa,EAEpB,IACEe,EACAC,EACAC,EACAC,EAGF,GAAGlB,EACD,GAAGG,EAAW,CACZ,MAAMgB,EAAOzG,EAAU0G,wBACjBF,EAAkBG,GAA8BC,YAAY,CAChEC,QAAS7G,EACTyE,IAAKa,EACLwB,MAAOL,EAAKK,MACZC,OAAQN,EAAKM,OACbC,KAAMnB,CACR,CAAC,EAEDS,EAAgBE,EAAgBS,eAChCX,EAAclE,UAAUC,IAAI5B,EAAOyG,YAAY,EAC3CrB,GAAeS,EAAclE,UAAUC,IAAI5B,EAAO0G,KAAK,EAE3DX,EAAgBY,eAAed,CAAa,CAC9C,MACED,EAAQ1E,SAAS0F,cAAc,KAAK,EACpChB,EAAMjE,UAAUC,IAAI5B,EAAOyG,YAAY,EACvCI,GAAmBjB,EAAOf,CAAa,EAI3C,MAAMiC,EAASC,GAAuBjC,CAAS,EAC/C,GAAGgC,EAAQ,CACT,KAAM,CAACE,OAAAA,EAAQC,iBAAAA,CAAgB,EAAIC,GAA+BC,OAAOL,CAAM,EAC/EhB,EAAiBkB,EACjB/I,EAAMmJ,oBAAoBH,CAAgB,EAC1CnB,EAAenE,UAAUC,IAAI5B,EAAOyG,YAAY,CAClD,CAEA,GAAGtB,EAAW,CACZ,IAAIkC,EACDzB,EACDyB,EAAezB,EAEfyB,EAAejC,EAAgBU,EAAiBD,EAGlD,IAAIyB,EAAaC,KAAKC,IAAIrC,CAAS,GAAKC,EAAgB,GAAK,GAC1DQ,EACD0B,EAAaC,KAAKE,IAAI,GAAK,EAAItC,CAAS,EAChCC,IACRkC,EAAaC,KAAKE,IAAI,GAAKH,CAAU,GAGvCD,GAAc7G,MAAMC,YAAY,gBAAiB,GAAK6G,CAAU,CAClE,CAEA7D,OAAAA,EAAS,CACPqC,eAAAA,EACAD,cAAAA,EACAD,MAAAA,CACF,CAAC,EAEM,CAACG,gBAAAA,EACV,CAEAlF,OAAAA,EAAQ,IAAM,CACZyC,EAAe1B,IAAI8F,MAAM,EAAE,SAAU,IAAM,CACzCxB,GAA8ByB,kBAAkBpI,CAAS,CAC3D,CAAC,EACD+D,EAAe1B,IAAIgC,CAAU,EAAE,eAAgB,CAACgE,EAAGC,IAAO,CACxDpE,EAAS,CACPE,SAAUkE,IAAO/D,GAAWC,MAC9B,CAAC,CACH,CAAC,CACH,CAAC,EAED+D,GAAaC,GAAG,IAAMvE,EAAMG,SAAU,IAAM,CAC1C,GAAGH,EAAMG,SAAU,OAEnB,MAAMqE,EAAUrC,IAEhB5G,EAAU,IAAM,CACd,MAAM8G,EAAgBrC,EAAMqC,cAC5BmC,EAAQlJ,KAAK,CAAC,CAACiH,gBAAAA,CAAe,IAAM,CAClCA,GAAiBkC,QAAQpC,CAAa,CACxC,CAAC,EAED5H,EAAMmJ,oBAAoBzG,MAAS,EAEnC8C,EAASyE,GAAU,CACjBvE,SAAUH,EAAMG,QACjB,CAAA,CAAC,CACJ,CAAC,CACF,CAAA,CAAC,EAEF5E,EAAU,IAAM,CACduE,EAAe6E,UAAS,CAC1B,CAAC,GAED,IAAA,CAAA,MAAAlJ,EAAAY,KAAAV,EACYI,EAAS,cAAAJ,GAAAE,WAAAA,EAAAF,EAAAF,CAAA,EAATM,EAASN,EAAAK,EAAAL,EAChBuE,IAAAA,EAAMsC,eAAc,IAAA,EAAAxG,EAAAL,EACpBuE,IAAAA,EAAMqC,cAAa,IAAA,EAAAvG,EAAAL,EACnBuE,IAAAA,EAAMoC,MAAK,IAAA,EAAAtG,EAAAL,GAAA,IAAA,CAAA,MAAAmJ,EAAAtG,GACXkC,IAAAA,CAAAA,CAAAA,EAAK,CAAA,EAAA,MAAA,IAALoE,EAAA,IAAA,IAAA,CAAA,MAAAxI,EAAAV,KAAAU,OAAAA,EAAAY,MAAAC,YAAA,aAAA,QAAA,EAAAX,EAAAI,GAAA,CAAA,MAAAC,EAAqBH,EAAOyG,aAAYrG,EAAsC4D,EAAG,EAAE7D,OAAAA,IAAAD,EAAAC,KAAAJ,EAAAH,EAAAM,EAAAC,IAAAA,CAAA,EAAAC,IAAAF,EAAAE,MAAAiI,GAAAzI,EAAAM,MAAAA,EAAAE,KAAAA,CAAA,EAAAF,CAAA,EAAA,CAAAC,IAAAQ,OAAAP,KAAAO,MAAA,CAAA,EAAAf,KAAI,GAAA,EAAA,IAAA,EAAAE,MAAAC,EAAAd,EAJ9De,EAAOsI,SAAS,CAAA,EAAArJ,CAAA,IAOhD,yWC1LMsJ,GAAe,EACfC,GAA2B,GAG3BC,GAIAxK,GAAU,CACd,IAAIsB,EACAX,EACA8J,EAEAC,EAAW,EAEf,KAAM,CAACC,aAAAA,EAAcC,mBAAAA,CAAmB,EAAGC,GAAkB,EACvD,CAACC,cAAAA,EAAeC,mBAAAA,EAAoBC,gBAAAA,CAAgB,EAAG5K,EAA2B,EAElFmF,EAAQ0F,GAA0B,CACtCC,eAAgB,CAAC,CAAClL,EAAMmL,aACxBC,QAAS,GACTC,gBAAiB,GACjBC,SAAU,GACVC,kBAAmB,EACrB,CAAC,EAEK,CAACC,CAAa,EAAIC,GAAe,IAAMC,GAAkBC,4BAA2B,CAAE,EAE5F/I,EAAQ,IAAM,CACZ8H,EAAW,EAEX,MAAMkB,EAAW5L,EAAMmL,aACpBS,IAAW,SAAW,CACvB,MAAMC,EAAeD,EAAS5D,wBACxBD,EAAO0C,EAAwBzC,wBAErC4D,EAASrJ,MAAMC,YAAY,MAAQuF,EAAK+D,KAAQ/D,EAAKK,MAAQ,EAAM,IAAI,EACvEwD,EAASrJ,MAAMC,YAAY,MAAQuF,EAAKgE,IAAOhE,EAAKM,OAAS,EAAM,IAAI,EACvEuD,EAASrJ,MAAMC,YAAY,UAAYuF,EAAKK,MAAQyD,EAAazD,MAAS,EAAE,EAC5EwD,EAASlI,UAAUC,IAAI,sDAAsD,EAE7E,MAAMF,EAAM,GAAG,EAEfmI,EAASlI,UAAUC,IAAI,qDAAqD,EAC5E4B,EAAM2F,eAAiB,GAEvB,MAAMzH,EAAM,GAAG,EACfmI,EAAS7K,OAAM,EACff,EAAMgM,iBAAc,CACtB,KAEA,MAAMnJ,EAAYC,GAAqB,CAClCG,SAASgJ,eAAiBhJ,SAASgJ,cAAcC,UAAY,SAChEC,GAAWxL,EAAmByL,MAAOtJ,CAAC,GAExCG,SAASC,iBAAiB,UAAWL,CAAQ,EAC7C/B,EAAU,IAAM,CACdmC,SAASE,oBAAoB,UAAWN,CAAQ,CAClD,CAAC,CACH,CAAC,EAED,IAAIwJ,EAEJ,SAASC,GAA2B,CAGlC,GAFAD,MAEG9G,EAAMyD,iBAAkB,CACzB,IAAIuD,EAAW,EACfF,EAAkBG,GAAa,EAAG,EAAG,IAAMC,GAAMF,EAAWE,CAAC,EAC7DlH,EAAMyD,iBAAiB0D,eAAe,IAAMH,CAAQ,CACtD,CACF,CAEA,MAAMI,EAAoCC,GAASN,EAA0B,IAAK,EAAI,EAEtFzC,GAAaC,GAAG,IAAMvE,EAAM+F,SAAU,IAAM,CAC1CqB,IAEApH,EAAM6F,QAAU,GAChB7F,EAAM8F,gBAAkB,EACzB,CAAA,CAAC,EAEFvK,EAAU,IAAM,CACdyE,EAAM+F,SAAW,GAChB3K,EAAmByL,MAA2BS,MAAQ,EACzD,CAAC,EAED,MAAMC,EAAYA,IAAM,CAAC,CAACvH,EAAM+F,UAAY/F,EAAM+F,SAASyB,QAAUC,GAE/DC,EAAa,SAAW,CAC5B,MAAMvG,EAAWwG,gBAAgB,MAAMC,EAAmBC,IAAI,WAAY,EAAK,CAAC,EAC1EC,EAAoB3G,GAAU4E,UAAU+B,kBAC9C,OAAIA,EAEDA,EAAoBC,KAAKC,IAAK,EAAS,IAE1ChI,EAAM8F,gBAAkB,GACxBX,EAAW,EACXhE,EAAS4E,SAAS+B,kBAAoB,KACtCF,EAAmBK,IAAI,CAAC9G,SAAAA,CAAQ,CAAC,EAC1B,IARuB,IAWhC,IAAI+G,EAAc,GAClB,MAAMC,EAAW,MAAM5K,GAAc,CAEnC,GADAA,GAAG6K,eAAc,EACdF,CAAAA,EAEHA,CAAAA,EAAc,GAEd,GAAI,CACF,GAAG,CAAE,MAAMR,EAAU,EACnB1H,EAAM8F,gBAAkB,WAChByB,EAAS,GAAM,MAAMnC,EAAapF,EAAM+F,QAAQ,EACxD,MAAMV,EAAmBrF,EAAM+F,QAAQ,EACvCtL,EAAM4N,SAAQ,UAEdlD,IACAnF,EAAM6F,QAAU,GACbV,EAAWJ,GAAc,CAC1B/E,EAAM8F,gBAAkB,GACxB,MAAM3E,EAAWwG,gBAAgB,MAAMC,EAAmBC,IAAI,WAAY,EAAK,CAAC,EAChF1G,EAAS4E,SAAS+B,kBAAoBC,KAAKC,IAAK,EAAGhD,GAA2B,IAC9E,MAAM4C,EAAmBK,IAAI,CAAC9G,SAAAA,CAAQ,CAAC,CACzC,CAEJ,MAAO,CACLnB,EAAM6F,QAAU,EAClB,QAAU,CACRqC,EAAc,EAChB,IAGIrB,EAAK7K,EACRuJ,EAAa,CACZ+C,gBAAiB9C,EACjB+C,YAAcjB,GAAU,KAAMlM,EAAqBkM,GAAM,IAAA,OAAA,CAAA,OAClD9K,EAAOgM,KAAK,EAAA,IACnBlB,OAAK,CAAA,OAAEtH,EAAM+F,QAAQ,EACrB0C,WAAanB,GAAU,KAAMtH,EAAM+F,SAAWuB,GAC9CoB,MAAK,iCAAA,IACLC,YAAU,CAAA,OACR3I,EAAM8F,gBACJ,+BACA9F,EAAM6F,QACJ,6BACA1I,MAAS,EAEfyL,UAAWnB,GAEd,EAGD,OAAA,IAAA,CAAA,MAAAhM,EAAAY,GAAA,EAAAD,EAAAX,EAAA+C,WAAAC,EAAArC,EAAAoC,WAAAE,EAAAD,EAAAD,WAAAG,EAAAD,EAAAE,YAAAC,EAAAJ,EAAAG,YAAAjD,EACYI,EAAS,cAAAJ,GAAAE,WAAAA,EAAAF,EAAAF,CAAA,EAATM,EAASN,EAAAK,EAAAL,EAAAO,EAChB4D,GAAU,CAACgE,oBAAsB0D,GAAU,KAAKtH,EAAMyD,iBAAmB6D,EAAM,CAAA,EAAAlL,CAAA,EAAAN,EAAAM,EAAAJ,EAE7EzB,GAAiB,CAAA,IAChBsC,QAAM,CAAA,OAAEmD,EAAM2F,cAAc,EAAA/J,IAAAiN,EAAA,CAAA,MAAAC,EACvB5D,EAAuB,OAAA4D,cAAAA,EAAAD,CAAA,EAAvB3D,EAAuB2D,CAAA,EAC5BzN,mBAAoBA,CAAkB,CAAA,EAAAqD,CAAA,EAAA3C,EAAAM,EAAAJ,EAEvC+M,EAAK,CAACC,OAAM,UAAA,CAAA,EAAAvK,CAAA,EAAAA,EAAAd,iBAAA,SACawK,CAAQ,EAAArM,EAAA2C,EAC/BoI,EAAKnI,CAAA,EAAA5C,EAAA2C,EAAAzC,EACL+M,EAAK,CAACC,OAAM,MAAA,CAAA,EAAAtK,CAAA,EAAAA,EAAAuK,YAGE,IAAM,CACjBd,KACDrM,EAAA4C,EAAA,IAIAe,EAAK,sBAAsB,CAAC,EAAAd,EAAA3B,MAAAC,YAAA,aAAA,QAAA,EAAA0B,EAAA3B,MAAAC,YAAA,SAAA,GAAA,EAAA0B,EAAA3B,MAAAC,YAAA,QAAA,GAAA,EAAAnB,EAAAM,EAAAJ,EAIhC+M,EAAK,CAACC,OAAM,UAAA,CAAA,EAAAnK,CAAA,EAAA/C,EAAA+C,EAGTY,IAAAA,EACEwG,EAAe,EAAG,EAChB,+CACA,yCACF,EAAA,IAAA,CAAA,MAAAnH,EAAApD,KAAAoD,OAAAA,EAAAE,QAGa,IAAM,CACbgB,EAAMgG,kBAAoB,IAC3B1J,MAAAC,EAAAuC,EAHMtC,EAAO0M,YAAY,CAAA,EAAApK,CAAA,GAAA,CAAA,CAMhC,CAAC,EAAAhD,EAAAL,EAAAO,EAKNoB,GAAW,CAAA,IACVmB,SAAO,CAAA,OAAEyB,EAAMgG,iBAAiB,EAAA,IAChC7G,OAAK,CAAA,OAAEM,EAAK,QAAQ,CAAC,EAAA,IACrBL,aAAW,CAAA,OAAEK,EAAK,sCAAsC,CAAC,EAAA,IACzDD,sBAAoB,CAAA,OAAEC,EAAK,QAAQ,CAAC,EACpCH,UAAWA,IAAM,CACfmG,EAAgB0D,WAAW,cAAehM,MAAS,CAEpD,EACDM,QAASA,IAAM,KAAKuC,EAAMgG,kBAAoB,GAAM,CAAA,EAAA,IAAA,EAAA1J,EAAAI,GAAA,CAAA,MAAAC,EArD5BH,EAAOsI,UAASlI,EAE9BJ,EAAO4M,KAAItM,EAeT,2CAA0CN,EAAO6M,YAAa,GAACC,EAC7D,CAACtJ,EAAM+F,SAAQwD,EAOjB/M,EAAOgN,YAAW7M,OAAAA,IAAAD,EAAAC,KAAAJ,EAAAd,EAAAiB,EAAAC,IAAAA,CAAA,EAAAC,IAAAF,EAAAE,MAAAL,EAAAH,EAAAM,EAAAE,KAAAA,CAAA,EAAAE,IAAAJ,EAAAI,MAAAP,EAAAmC,EAAAhC,EAAAI,KAAAA,CAAA,EAAAwM,IAAA5M,EAAA4M,OAAA5K,EAAA+K,SAAA/M,EAAA4M,KAAAA,GAAAC,IAAA7M,EAAA6M,MAAAhN,EAAAsC,EAAAnC,EAAA6M,KAAAA,CAAA,EAAA7M,CAAA,EAAA,CAAAC,IAAAQ,OAAAP,KAAAO,OAAAL,KAAAK,OAAAmM,KAAAnM,OAAAoM,KAAApM,MAAA,CAAA,EAAA1B,CAAA,IAgCtC,EAEkCkE,GAAA,CAAA,YAAA,OAAA,CAAA"}