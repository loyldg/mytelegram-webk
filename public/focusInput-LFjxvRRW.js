import{bU as J,bc as Z,R as tt,a2 as it,a5 as P,aC as A,U as et,ff as st,aD as Y,cw as nt,fg as at,f3 as ot,b9 as rt,ai as ht,d2 as ct,bv as z,bS as lt,aY as dt,dP as X,aQ as ut,bK as mt,m as gt,a9 as ft,dx as _t,p as pt}from"./index-OONtJtwu.js";const xt=it("<div>");function Nt(s){const[i,t]=J(s,["amount","withTransition"]);return(()=>{const e=xt();return Z(e,tt(t,{get style(){return{"padding-top":i.amount,transition:i.withTransition?".2s":void 0}}}),!1,!1),e})()}function vt(s){return P(()=>{const i=s.name||"s";return{enterActive:(s.enterActiveClass||i+"-enter-active").split(" "),enter:(s.enterClass||i+"-enter").split(" "),enterTo:(s.enterToClass||i+"-enter-to").split(" "),exitActive:(s.exitActiveClass||i+"-exit-active").split(" "),exit:(s.exitClass||i+"-exit").split(" "),exitTo:(s.exitToClass||i+"-exit-to").split(" ")}})}function $(s){requestAnimationFrame(()=>requestAnimationFrame(s))}function Pt(s,i,t,e,n){const{onBeforeEnter:h,onEnter:c,onAfterEnter:u}=i;let o;h?.(t),t.classList.add(...s.enter),t.classList.add(...s.enterActive),queueMicrotask(()=>{if(!t.parentNode)return e?.();c?.(t,()=>a())}),$(()=>{t.classList.remove(...s.enter),t.classList.add(...s.enterTo),(!c||c.length<2)&&(t.addEventListener("transitionend",a),t.addEventListener("animationend",a),n!==void 0&&(o=window.setTimeout(()=>a(),n)))});function a(d){(!d||d.target===t)&&(clearTimeout(o),e?.(),t.removeEventListener("transitionend",a),t.removeEventListener("animationend",a),t.classList.remove(...s.enterActive),t.classList.remove(...s.enterTo),u?.(t))}}function Tt(s,i,t,e,n){const{onBeforeExit:h,onExit:c,onAfterExit:u}=i;if(!t.parentNode)return e?.();let o;h?.(t),t.classList.add(...s.exit),t.classList.add(...s.exitActive),c?.(t,()=>a()),$(()=>{t.classList.remove(...s.exit),t.classList.add(...s.exitTo),(!c||c.length<2)&&(t.addEventListener("transitionend",a),t.addEventListener("animationend",a),n!==void 0&&(o=window.setTimeout(()=>a(),n)))});function a(d){(!d||d.target===t)&&(clearTimeout(o),e?.(),t.removeEventListener("transitionend",a),t.removeEventListener("animationend",a),t.classList.remove(...s.exitActive),t.classList.remove(...s.exitTo),u?.(t))}}var wt=()=>{},G=(s,i)=>i();function Et(s,i){const t=A(s),e=t?[t]:[],{onEnter:n=G,onExit:h=G}=i,[c,u]=et(i.appear?[]:e),[o]=nt();let a,d=!1;function l(r,g){if(!r)return g&&g();d=!0,h(r,()=>{Y(()=>{d=!1,u(x=>x.filter(b=>b!==r)),g&&g()})})}function f(r){const g=a;if(!g)return r&&r();a=void 0,u(x=>[g,...x]),n(g,r??wt)}const m=i.mode==="out-in"?r=>d||l(r,f):i.mode==="in-out"?r=>f(()=>l(r)):r=>{l(r),f()};return st(r=>{const g=s();return A(o)?(o(),r):(g!==r&&(a=g,Y(()=>A(()=>m(r)))),g)},i.appear?void 0:t),c}var E=s=>s instanceof Element;function S(s,i){if(i(s))return s;if(typeof s=="function"&&!s.length)return S(s(),i);if(Array.isArray(s)){const t=[];for(const e of s){const n=S(e,i);n&&(Array.isArray(n)?t.push.apply(t,n):t.push(n))}return t.length?t:null}return null}function Dt(s,i=E,t=E){const e=P(s),n=P(()=>S(e(),i));return n.toArray=()=>{const h=n();return Array.isArray(h)?h:h?[h]:[]},n}function C(s,i){if(i(s))return s;if(typeof s=="function"&&!s.length)return C(s(),i);if(Array.isArray(s))for(const t of s){const e=C(t,i);if(e)return e}return null}function yt(s,i=E,t=E){const e=P(s);return P(()=>C(e(),i))}const At={inout:"in-out",outin:"out-in"},Ut=s=>{const i=vt(s);return Et(yt(()=>s.children),{mode:At[s.mode],appear:s.appear,onEnter(t,e){Pt(i(),s,t,e,s.duration)},onExit(t,e){Tt(i(),s,t,e,s.duration)}})},y=class y extends at{static getWallPaperStorageUrl(i,t){return`backgrounds/${i}${t?"?blur":""}`}static hasWallPaperStorageUrl(i,t){const e=this.getWallPaperStorageUrl(i,t);return this.cacheStorage.has(e)}static getBackground({slug:i,canDownload:t,blur:e,managers:n,appDownloadManager:h}){var o;const c=this.getWallPaperStorageUrl(i,e),u=t&&!!n&&!!h;return(o=this.backgroundPromises)[c]||(o[c]=this.cacheStorage.getFile(c).then(a=>this.backgroundPromises[c]=URL.createObjectURL(a),u?async a=>{if(a.type!=="NO_ENTRY_FOUND")throw a;const d=await n.appThemesManager.getWallPaperBySlug(i);let l=await h.downloadMediaURL({media:d.document});return e&&(l=await this.blurWallPaperImage(l)),this.saveWallPaperToCache(i,l,e),this.backgroundPromises[c]=l}:void 0))}static blurWallPaperImage(i){const{canvas:t,promise:e}=rt(i,12,4);return e.then(()=>t.toDataURL())}static saveWallPaperToCache(i,t,e){if(!(!i||i===ht))return fetch(t).then(n=>this.cacheStorage.save(this.getWallPaperStorageUrl(i,e),n))}static setBackgroundUrlToCache({slug:i,url:t,blur:e}){this.backgroundPromises[this.getWallPaperStorageUrl(i,e)]=t}};y.cacheStorage=new ot("cachedBackgrounds"),y.backgroundPromises={};let B=y;function St(s,i){return-i*s*(s-2)}const I=50,k=I;class q{constructor(){this._width=I,this._height=k,this._tails=90,this._curve=[0,.25,.5,.75,1,1.5,2,2.5,3,3.5,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,18.3,18.6,18.9,19.2,19.5,19.8,20.1,20.4,20.7,21,21.3,21.6,21.9,22.2,22.5,22.8,23.1,23.4,23.7,24,24.3,24.6,24.9,25.2,25.5,25.8,26.1,26.3,26.4,26.5,26.6,26.7,26.8,26.9,27],this._positions=[{x:.8,y:.1},{x:.6,y:.2},{x:.35,y:.25},{x:.25,y:.6},{x:.2,y:.9},{x:.4,y:.8},{x:.65,y:.75},{x:.75,y:.4}],this._phases=this._positions.length,this.drawNextPositionAnimated=t=>{let e,n;if(t){const h=t();e=h>=1;const c=St(h,1),u=this._nextPositionTail??0,a=(this._nextPositionTail=this._nextPositionTails*c)-u;a&&(this._nextPositionLeft-=a,this.changeTailAndDraw(-a))}else{const h=this._frames;n=h.shift(),e=!h.length}return n&&this.drawImageData(n),e&&(this._nextPositionLeft=void 0,this._nextPositionTails=void 0,this._nextPositionTail=void 0,this._animatingToNextPosition=void 0),!e};const i=this._tails/this._curve[this._curve.length-1];for(let t=0,e=this._curve.length;t<e;++t)this._curve[t]=this._curve[t]*i;this._incrementalCurve=this._curve.map((t,e,n)=>t-(n[e-1]??0))}hexToRgb(i){const t=ct(i);return{r:t[0],g:t[1],b:t[2]}}getPositions(i){const t=this._positions.slice();t.push(...t.splice(0,i));const e=[];for(let n=0;n<t.length;n+=2)e.push(t[n]);return e}getNextPositions(i,t,e){const n=this.getPositions(i);if(!e[0]&&e.length===1)return[n];const c=this.getPositions(++i%this._phases).map((o,a)=>({x:(o.x-n[a].x)/t,y:(o.y-n[a].y)/t}));return e.map(o=>c.map((a,d)=>({x:n[d].x+a.x*o,y:n[d].y+a.y*o})))}curPosition(i,t){return this.getNextPositions(i,this._tails,[t])[0]}changeTail(i){for(this._tail+=i;this._tail>=this._tails;)this._tail-=this._tails,++this._phase>=this._phases&&(this._phase-=this._phases);for(;this._tail<0;)this._tail+=this._tails,--this._phase<0&&(this._phase+=this._phases)}changeTailAndDraw(i){this.changeTail(i);const t=this.curPosition(this._phase,this._tail);this.drawGradient(t)}getGradientImageData(i,t=this._phase,e=1-this._tail/this._tails){const n=this._hctx.createImageData(this._width,this._height),h=n.data,c=this._colors.length,u=f=>{const m=[];for(let r=0;r!=4;++r)m[r]={...this._positions[(f+r*2)%this._positions.length]},m[r].y=1-m[r].y;return m},o=(t+1)%this._positions.length,a=u(o),d=u(t);let l=0;for(let f=0;f<this._height;++f){const r=f/this._height-.5,g=r*r;for(let x=0;x<this._width;++x){const T=x/this._width-.5,L=.35*Math.sqrt(T*T+g),N=L*L*.8*8,D=Math.sin(N),U=Math.cos(N),K=Math.max(0,Math.min(1,.5+T*U-r*D)),Q=Math.max(0,Math.min(1,.5+T*D+r*U));let w=0,R=0,F=0,M=0;for(let _=0;_<c;++_){const j=a[_].x+(d[_].x-a[_].x)*e,V=a[_].y+(d[_].y-a[_].y)*e,O=K-j,W=Q-V;let p=Math.max(0,.9-Math.sqrt(O*O+W*W));p=p*p*p*p,w+=p,R+=p*this._colors[_].r,F+=p*this._colors[_].g,M+=p*this._colors[_].b}h[l++]=R/w,h[l++]=F/w,h[l++]=M/w,h[l++]=255}}return n}drawImageData(i){this._hctx.putImageData(i,0,0),this._ctx.drawImage(this._hc,0,0,this._width,this._height)}drawGradient(i){this.drawImageData(this.getGradientImageData(i))}init(i){this._frames=[],this._phase=0,this._tail=0;const t=i.getAttribute("data-colors").split(",");this._colors=t.map(e=>this.hexToRgb(e)),this._hc||(this._hc=document.createElement("canvas"),this._hc.width=this._width,this._hc.height=this._height,this._hctx=this._hc.getContext("2d",{alpha:!1})),this._canvas=i,this._ctx=this._canvas.getContext("2d",{alpha:!1}),this.update()}update(){if(this._colors.length<2){const t=this._colors[0];this._ctx.fillStyle=`rgb(${t.r}, ${t.g}, ${t.b})`,this._ctx.fillRect(0,0,this._width,this._height);return}const i=this.curPosition(this._phase,this._tail);this.drawGradient(i)}toNextPosition(i){if(this._colors.length<2)return;if(i){this._nextPositionLeft=this._tails+(this._nextPositionLeft??0),this._nextPositionTails=this._nextPositionLeft,this._nextPositionTail=void 0,this._animatingToNextPosition=!0,z(this.drawNextPositionAnimated.bind(this,i),this);return}const t=this._tail,e=this._tails;let n;const h=[];for(let o=0,a=this._incrementalCurve.length;o<a;++o){const d=this._incrementalCurve[o];let l=(h[o-1]??t)+d;+l.toFixed(2)>e&&n===void 0&&(n=o,l%=e),h.push(l)}const c=h.slice(0,n),u=n!==void 0?h.slice(n):[];[c,u].forEach((o,a,d)=>{const l=o[o.length-1];if(l!==void 0&&l>e&&(o[o.length-1]=+l.toFixed(2)),this._tail=l??0,!o.length)return;const f=this.getNextPositions(this._phase,e,o);a!==d.length-1&&++this._phase>=this._phases&&(this._phase-=this._phases);const m=f.map(r=>this.getGradientImageData(r));this._frames.push(...m)}),this._animatingToNextPosition=!0,z(this.drawNextPositionAnimated,this)}cleanup(){}static createCanvas(i){const t=document.createElement("canvas");return t.width=I,t.height=k,i!==void 0&&(t.dataset.colors=i),t}static create(i){const t=this.createCanvas(i),e=new q;return e.init(t),{gradientRenderer:e,canvas:t}}}const Ct=!1,It=X&&_t,v=class v{constructor(){this.canvases=new Set}static getInstance(i){let t=this.INSTANCES.find(e=>e.options.element===i.element&&lt(e.options,i,["element"]));return t||(t=new v,t.init(i),this.INSTANCES.push(t)),t}init(i){this.options=i}renderToCanvas(i){return this.renderImageFromUrl(this.options.url).then(()=>this.fillCanvas(i))}renderImageFromUrl(i){if(this.renderImageFromUrlPromise)return this.renderImageFromUrlPromise;const t=this.image=document.createElement("img");return t.crossOrigin="anonymous",this.renderImageFromUrlPromise=dt(t,i,!1).then(()=>!X||!It?t:createImageBitmap(t,{resizeWidth:1440,resizeHeight:2960}).then(e=>(this.imageBitmap=e,t)))}cleanup(i){this.canvases.delete(i),this.canvases.size||(ut(v.INSTANCES,this),this.imageBitmap?.close())}fillCanvas(i){const t=i.getContext("2d"),{width:e,height:n}=i,h=this.imageBitmap||this.image;let c=h.width,u=h.height;const o=(500+mt.height/2.5)*i.dpr,a=o/u;c*=a,u=o,this.options.mask?(t.fillStyle="#000",t.fillRect(0,0,e,n),t.globalCompositeOperation="destination-out"):t.globalCompositeOperation="source-over";const d=m=>{for(let r=0;r<e;r+=c)t.drawImage(h,r,m,c,u)},l=(n-u)/2;if(d(l),l>0){let m=l;do d(m-=u);while(m>=0)}const f=n-1;for(let m=l+u;m<f;m+=u)d(m)}setCanvasDimensions(i){const t=Math.min(2,window.devicePixelRatio),e=this.options.width*t;let n=this.options.height*t;i.dpr=t,i.dataset.originalHeight=""+n,gt.activeScreen===ft.large&&Ct&&(n*=1.5),i.width=e,i.height=n}createCanvas(){const i=document.createElement("canvas");return this.canvases.add(i),this.setCanvasDimensions(i),i}resize(i,t){this.init({...this.options,width:i,height:t});const e=[];for(const n of this.canvases)this.setCanvasDimensions(n),e.push(this.renderToCanvas(n));return Promise.all(e)}static resizeInstancesOf(i){const t=this.INSTANCES.filter(n=>n.options.element===i),e=i.getBoundingClientRect();return Promise.all(t.map(n=>n.resize(e.width,e.height)))}};v.INSTANCES=[];let H=v;function Rt(s,i){if(s.focus(),pt(s),i){const t=new KeyboardEvent(i.type,i);s.dispatchEvent(t)}}export{H as C,Nt as S,Ut as T,q as a,B as b,yt as c,Rt as f,Dt as r};
//# sourceMappingURL=focusInput-LFjxvRRW.js.map
