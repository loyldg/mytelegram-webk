import{R as ie,T as W,U as H,V as M,W as I,X as U,Y as u,Z as P,$ as b,a0 as ce,a1 as le,a2 as S,a3 as se,a4 as X,u as x,a5 as oe,a6 as Z,k as J,i as T,a7 as de,a8 as ue,m as Q,a9 as ee,aa as ae,ab as re,ac as pe,ad as me,ae as ge,af as fe,ag as ve,ah as _e,ai as z,aj as ye,ak as ke,al as Ce,am as he,o as O,q as $e}from"./index-CffH4yV9.js";import{u as Pe,M as te}from"./actions-BqU5SpaD.js";import{T as be,C as ne,a as we,b as Le,S as G,f as Me}from"./focusInput-D0PB-chd.js";const Se="_PasswordMonkey_1h0e6_1",Ae="_hidden_1h0e6_8",Ee="_MonkeyImage_1h0e6_13",N={PasswordMonkey:Se,hidden:Ae,MonkeyImage:Ee},Te=S("<img src=assets/img/password-monkey-closed.png>"),Ie=S("<div>"),Re=p=>{const s=ie({size:100},p),{PasswordMonkey:r}=W(),[C,_]=H(),[$,w]=H(!1);return M(()=>{const a=new r(s.passwordInputField,s.size);a.load().then(()=>w(!0)),_(a),I(()=>{a.remove()})}),(()=>{const a=Ie(),h=s.ref;return typeof h=="function"?U(h,a):s.ref=a,u(a,()=>C().container,null),u(a,P(ce,{get when(){return!$()},get children(){const g=Te();return M(()=>b(g,N.MonkeyImage)),g}}),null),M(g=>{const n=N.PasswordMonkey,R={[N.hidden]:s.hidden},e=s.size+"px";return n!==g._v$&&b(a,g._v$=n),g._v$2=le(a,R,g._v$2),e!==g._v$3&&((g._v$3=e)!=null?a.style.setProperty("--size",e):a.style.removeProperty("--size")),g},{_v$:void 0,_v$2:void 0,_v$3:void 0}),a})()},Be="_Popup_1o70z_1",xe={Popup:Be},Ue=S('<div><div class=popup-container><div class=popup-header><div class=popup-title></div></div><div class=popup-description></div><div class=popup-buttons><button class="popup-button btn danger"></button><button class="popup-button btn primary"autofocus>'),Oe=p=>(X(()=>{const s=r=>{r.key==="Escape"&&p.onClose?.()};document.addEventListener("keydown",s),I(()=>{document.removeEventListener("keydown",s)})}),P(de,{get children(){return P(be,{onEnter:async(s,r)=>{await x(0),s.classList.add("active"),await x(0),r()},onExit:async(s,r)=>{s.classList.remove("active"),await x(200),r()},get children(){return oe(()=>!!p.visible)()&&(()=>{const s=Ue(),r=s.firstChild,C=r.firstChild,_=C.firstChild,$=C.nextSibling,w=$.nextSibling,a=w.firstChild,h=a.nextSibling;return s.$$click=g=>{g.target===g.currentTarget&&p.onClose?.()},u(_,()=>p.title),u($,()=>p.description),Z(a,"click",p.onConfirm,!0),U(J,a,()=>!0),u(a,()=>p.confirmButtonContent),Z(h,"click",p.onClose,!0),U(J,h,()=>!0),u(h,()=>T("Cancel")),M(()=>b(s,"popup popup-peer popup-confirmation "+xe.Popup)),s})()}})}}));se(["click"]);const De="_Container_nve2r_1",Fe="_CanvasCommon_nve2r_11",ze="_blend_nve2r_22",A={Container:De,CanvasCommon:Fe,blend:ze},Ge=S("<div>"),Ne=S("<img>"),He=p=>{const{themeController:s}=W();let r;const C=new ge,[_,$]=ue({isMobile:Q.activeScreen===ee.mobile}),[w,a]=H();async function h(e){return e===z?"assets/img/pattern.svg":Le.getWallPaperStorageUrl(e)}async function g(e){try{return await h(e)}catch{return h(z)}}async function n(){try{const e=s.getTheme(),f=e.settings?.wallpaper?.slug,k=f?await h(f):void 0,{wallpaper:v}=s.getThemeSettings(e),y=!!v?.pFlags?.pattern,i=v.settings?.intensity&&v.settings.intensity/100,m=!!i&&i<0;return{backgroundUrl:k,isPattern:y,isDarkPattern:m,intensity:i,wallPaper:v}}catch{const e=s.getTheme(),f=_e.themes.find(t=>t.name===e.name),k=f.settings?.wallpaper?.slug||z,v=await g(k),{wallpaper:y}=s.getThemeSettings(f),i=!!y?.pFlags?.pattern,m=y.settings?.intensity&&y.settings.intensity/100,L=!!m&&m<0;return{backgroundUrl:v,isPattern:i,isDarkPattern:L,intensity:m,wallPaper:y}}}async function R(){const{backgroundUrl:e,isPattern:f,isDarkPattern:k,intensity:v,wallPaper:y}=await n();a(e);let i,m,L,t;if(e)if(f){const l=r.getBoundingClientRect(),o=ne.getInstance({element:r,url:e,width:l.width,height:l.height,mask:k});m=o.createCanvas(),m.classList.add(A.CanvasCommon),k||m.classList.add(A.blend),o.renderToCanvas(m)}else i=document.createElement("img"),i.classList.add(A.CanvasCommon),fe(i,e);const c=ve(y);if(c){const{canvas:l,gradientRenderer:o}=we.create(c);L=l,p.gradientRendererRef(o),L.classList.add(A.CanvasCommon)}if(v){let l;i?l=i:l=k?L:m;let o=Math.abs(v)*(k?.5:1);i?o=Math.max(.3,1-v):k&&(o=Math.max(.3,o)),l?.style.setProperty("--opacity-max",""+o)}return $({gradientCanvas:L,patternCanvas:m,image:i}),{patternRenderer:t}}return X(()=>{C.add(window)("resize",()=>{ne.resizeInstancesOf(r)}),C.add(Q)("changeScreen",(e,f)=>{$({isMobile:f===ee.mobile})})}),ae(re(()=>_.isMobile,()=>{if(_.isMobile)return;const e=R();I(()=>{const f=_.patternCanvas;e.then(({patternRenderer:k})=>{k?.cleanup(f)}),p.gradientRendererRef(void 0),$(pe({isMobile:_.isMobile}))})})),I(()=>{C.removeAll()}),(()=>{const e=Ge(),f=r;return typeof f=="function"?U(f,e):r=e,u(e,()=>_.gradientCanvas,null),u(e,()=>_.patternCanvas,null),u(e,()=>_.image,null),u(e,(()=>{const k=oe(()=>!!w());return()=>k()&&(()=>{const v=Ne();return v.style.setProperty("visibility","hidden"),M(y=>{const i=A.CanvasCommon,m=w();return i!==y._v$&&b(v,y._v$=i),m!==y._v$2&&me(v,"src",y._v$2=m),y},{_v$:void 0,_v$2:void 0}),v})()})(),null),M(()=>b(e,A.Container)),e})()},We="_Container_likt7_36",Xe="_Card_likt7_46",Ve="_Description_likt7_60",Ye="_Input_likt7_67",je="_SubmitButton_likt7_71",qe="_LogoutButton_likt7_75",E={Container:We,Card:Xe,Description:Ve,Input:Ye,SubmitButton:je,LogoutButton:qe},Ke=S('<div><div><form action=""><button type=button></button><button hidden type=submit></button></form><div>'),Ze=S("<button>"),Je=5,Qe=60,st=p=>{let s,r,C,_=0;const{isMyPasscode:$,unlockWithPasscode:w}=Pe(),{InputFieldTsx:a,PasswordInputField:h,apiManagerProxy:g}=W(),n=ye({isMonkeyHidden:!!p.fromLockIcon,isError:!1,tooManyAttempts:!1,passcode:"",isLogoutPopupOpen:!1}),[R]=ke(()=>$e.getUnencryptedTotalAccounts());X(()=>{_=0;const t=p.fromLockIcon;t&&(async()=>{const l=t.getBoundingClientRect(),o=C.getBoundingClientRect();t.style.setProperty("--x",o.left+o.width/2+"px"),t.style.setProperty("--y",o.top+o.height/2+"px"),t.style.setProperty("--scale",o.width/l.width+""),t.classList.add("passcode-lock-screen__animated-lock-icon--shift-body"),await x(500),t.classList.add("passcode-lock-screen__animated-lock-icon--disappear"),n.isMonkeyHidden=!1,await x(400),t.remove(),p.onAnimationEnd?.()})();const c=l=>{document.activeElement&&document.activeElement.tagName==="INPUT"||Me(r.input,l)};document.addEventListener("keydown",c),I(()=>{document.removeEventListener("keydown",c)})});let e;function f(){if(e?.(),n.gradientRenderer){let t=0;e=he(0,1,200,c=>t=c),n.gradientRenderer.toNextPosition(()=>t)}}const k=Ce(f,100,!0);ae(re(()=>n.passcode,()=>{k(),n.isError=!1,n.tooManyAttempts=!1})),I(()=>{n.passcode="",r.input.value=""});const v=()=>!!n.passcode&&n.passcode.length<=te,y=async()=>{const t=structuredClone(await O.get("settings",!1)),c=t?.passcode?.canAttemptAgainOn;return c?c>Date.now()?!1:(n.tooManyAttempts=!1,_=0,t.passcode.canAttemptAgainOn=null,O.set({settings:t}),!0):!0};let i=!1;const m=async t=>{if(t?.preventDefault(),!i){i=!0;try{if(!await y())n.tooManyAttempts=!0;else if(v()&&await $(n.passcode))await w(n.passcode),p.onUnlock();else if(_++,n.isError=!0,_>Je){n.tooManyAttempts=!0;const c=structuredClone(await O.get("settings",!1));c.passcode.canAttemptAgainOn=Date.now()+Qe*1e3,await O.set({settings:c})}}catch{n.isError=!0}finally{i=!1}}},L=P(a,{InputFieldClass:h,instanceRef:t=>void(r=t),get class(){return E.Input},get value(){return n.passcode},onRawInput:t=>void(n.passcode=t),label:"PasscodeLock.EnterYourPasscode",get errorLabel(){return n.tooManyAttempts?"PasscodeLock.TooManyAttempts":n.isError?"PasscodeLock.WrongPasscode":void 0},maxLength:te});return(()=>{const t=Ke(),c=t.firstChild,l=c.firstChild,o=l.firstChild,D=o.nextSibling,F=l.nextSibling,V=s;return typeof V=="function"?U(V,t):s=t,u(t,P(He,{gradientRendererRef:d=>void(n.gradientRenderer=d)}),c),u(c,P(Re,{get hidden(){return n.isMonkeyHidden},ref(d){const B=C;typeof B=="function"?B(d):C=d},passwordInputField:r}),l),u(c,P(G,{amount:"1.125rem"}),l),l.addEventListener("submit",m),u(l,L,o),u(l,P(G,{amount:"1rem"}),o),o.$$mousedown=()=>{m()},u(o,()=>T("PasscodeLock.Proceed")),D.style.setProperty("visibility","hidden"),D.style.setProperty("height","0"),D.style.setProperty("width","0"),u(c,P(G,{amount:"1.625rem"}),F),u(F,()=>T(R()>1?"PasscodeLock.ForgotPasscode.MultipleAccounts":"PasscodeLock.ForgotPasscode.OneAccount",[(()=>{const d=Ze();return d.$$click=()=>{n.isLogoutPopupOpen=!0},M(()=>b(d,E.LogoutButton)),d})()])),u(t,P(Oe,{get visible(){return n.isLogoutPopupOpen},get title(){return T("LogOut")},get description(){return T("PasscodeLock.LogoutPopup.Description")},get confirmButtonContent(){return T("LogOut")},onConfirm:()=>{g.invokeVoid("forceLogout",void 0)},onClose:()=>void(n.isLogoutPopupOpen=!1)}),null),M(d=>{const B=E.Container,Y=E.Card,j=`btn-primary btn-color-primary btn-large ${E.SubmitButton}`,q=!n.passcode,K=E.Description;return B!==d._v$&&b(t,d._v$=B),Y!==d._v$2&&b(c,d._v$2=Y),j!==d._v$3&&b(o,d._v$3=j),q!==d._v$4&&(o.disabled=d._v$4=q),K!==d._v$5&&b(F,d._v$5=K),d},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0,_v$5:void 0}),t})()};se(["mousedown","click"]);export{st as default};
//# sourceMappingURL=passcodeLockScreen-fm7AcL16.js.map
